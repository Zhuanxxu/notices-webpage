(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[528],{675:function(e,t,a){Promise.resolve().then(a.bind(a,5618))},5618:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var r=a(7821),o=a(8078),i=a(6179),s=a(4417);function l(){var e;let t=(0,i.useRouter)(),a=parseInt((0,i.useParams)().id),[l,n]=(0,o.useState)(!0),[d,c]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),[g,x]=(0,o.useState)(null),[p,h]=(0,o.useState)(null),[b,v]=(0,o.useState)([]),[f,y]=(0,o.useState)([]),[j,_]=(0,o.useState)([]),[N,w]=(0,o.useState)([]),[k,C]=(0,o.useState)(!1),[S,E]=(0,o.useState)(null),[F,P]=(0,o.useState)({media_source_id:"",coverage_url:"",coverage_title:"",snippet:""}),[Z,q]=(0,o.useState)({title:"",content:"",excerpt:"",editor_content:"",status:"draft",political_bias:"",location:""});(0,o.useEffect)(()=>{I()},[a]);let I=async()=>{try{var e,r;let[t,o,i,l]=await Promise.all([s.Z.get("/articles/".concat(a)),s.Z.get("/media-sources"),s.Z.get("/tags"),s.Z.get("/coverages/article/".concat(a))]),n=t.data;h(n),q({title:n.title,content:n.content,excerpt:n.excerpt||"",editor_content:n.editor_content||"",status:n.status,political_bias:(null===(e=n.classification)||void 0===e?void 0:e.political_bias)||"",location:n.location||""}),x(n.cover_image||null),v(o.data),y(i.data),_((null===(r=n.tags)||void 0===r?void 0:r.map(e=>e.id))||[]),w(l.data)}catch(e){console.error("Error fetching data:",e),alert("Error al cargar la noticia"),t.push("/admin/articles")}finally{n(!1)}},z=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){m(!0);try{let e=new FormData;e.append("image",a);let t=localStorage.getItem("token"),r=await fetch("".concat("http://localhost:3001","/api/upload"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:e});if(!r.ok)throw Error("Error al subir la imagen");let o=await r.json();x(o.filePath)}catch(e){console.error("Error uploading image:",e),alert("Error al subir la imagen")}finally{m(!1)}}},B=async e=>{e.preventDefault(),c(!0);try{let e={title:Z.title,content:Z.content,status:Z.status};Z.excerpt&&(e.excerpt=Z.excerpt),Z.editor_content&&(e.editor_content=Z.editor_content),null!==g&&(e.cover_image=g),Z.political_bias&&(e.political_bias=Z.political_bias),Z.location&&(e.location=Z.location),e.tag_ids=j,await s.Z.put("/articles/".concat(a),e),await I(),alert("Noticia actualizada correctamente")}catch(e){var t,r;console.error("Error updating article:",e),alert((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Error al actualizar la noticia")}finally{c(!1)}},A=async e=>{e.preventDefault();try{S?await s.Z.put("/coverages/".concat(S),{...F,media_source_id:parseInt(F.media_source_id)}):await s.Z.post("/coverages",{article_id:a,...F,media_source_id:parseInt(F.media_source_id)}),P({media_source_id:"",coverage_url:"",coverage_title:"",snippet:""}),C(!1),E(null),I()}catch(e){var t,r;console.error("Error saving coverage:",e),alert((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Error al ".concat(S?"actualizar":"agregar"," cobertura"))}},D=e=>{var t;P({media_source_id:(null===(t=e.media_source_id)||void 0===t?void 0:t.toString())||"",coverage_url:e.coverage_url,coverage_title:e.coverage_title,snippet:e.snippet||""}),E(e.id),C(!0)},T=()=>{P({media_source_id:"",coverage_url:"",coverage_title:"",snippet:""}),E(null),C(!1)},R=async e=>{if(confirm("\xbfEliminar esta cobertura?"))try{await s.Z.delete("/coverages/".concat(e)),I()}catch(e){console.error("Error deleting coverage:",e),alert("Error al eliminar cobertura")}};return l?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"})}):(0,r.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Editar Noticia"}),(0,r.jsx)("form",{onSubmit:B,className:"bg-white shadow rounded-lg p-6 mb-6",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"T\xedtulo *"}),(0,r.jsx)("input",{type:"text",id:"title",required:!0,value:Z.title,onChange:e=>q({...Z,title:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"excerpt",className:"block text-sm font-medium text-gray-700",children:"Subt\xedtulo / Breve Descripci\xf3n"}),(0,r.jsx)("textarea",{id:"excerpt",rows:3,value:Z.excerpt,onChange:e=>q({...Z,excerpt:e.target.value}),placeholder:"Breve descripci\xf3n que aparecer\xe1 en la p\xe1gina principal (opcional)",maxLength:500,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),(0,r.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:[Z.excerpt.length,"/500 caracteres"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Contenido *"}),(0,r.jsx)("textarea",{id:"content",required:!0,rows:10,value:Z.content,onChange:e=>q({...Z,content:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"cover_image",className:"block text-sm font-medium text-gray-700",children:"Foto de Portada"}),(0,r.jsx)("input",{type:"file",id:"cover_image",accept:"image/*",onChange:z,disabled:u,className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"}),u&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Subiendo imagen..."}),g&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("img",{src:"".concat("http://localhost:3001").concat(g),alt:"Vista previa",className:"max-w-md h-48 object-cover rounded-lg border border-gray-300"}),(0,r.jsx)("button",{type:"button",onClick:()=>x(null),className:"mt-2 text-sm text-red-600 hover:text-red-800",children:"Eliminar imagen"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"editor_content",className:"block text-sm font-medium text-gray-700",children:"Redacci\xf3n Editorial"}),(0,r.jsx)("textarea",{id:"editor_content",rows:6,value:Z.editor_content,onChange:e=>q({...Z,editor_content:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Estado"}),(0,r.jsxs)("select",{id:"status",value:Z.status,onChange:e=>q({...Z,status:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[(0,r.jsx)("option",{value:"draft",children:"Borrador"}),(0,r.jsx)("option",{value:"published",children:"Publicada"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"political_bias",className:"block text-sm font-medium text-gray-700",children:"Sesgo Pol\xedtico"}),(0,r.jsxs)("select",{id:"political_bias",value:Z.political_bias,onChange:e=>q({...Z,political_bias:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[(0,r.jsx)("option",{value:"",children:"Sin clasificar"}),(0,r.jsx)("option",{value:"left",children:"Izquierda"}),(0,r.jsx)("option",{value:"center",children:"Centro"}),(0,r.jsx)("option",{value:"right",children:"Derecha"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700",children:"Ubicaci\xf3n (Ciudad o Provincia)"}),(0,r.jsx)("input",{type:"text",id:"location",value:Z.location,onChange:e=>q({...Z,location:e.target.value}),placeholder:"Ej: Buenos Aires, C\xf3rdoba, etc.",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags / Categor\xedas"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:f.map(e=>(0,r.jsxs)("label",{className:"flex items-center space-x-2 p-2 border border-gray-300 rounded-md hover:bg-gray-50 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:j.includes(e.id),onChange:t=>{t.target.checked?_([...j,e.id]):_(j.filter(t=>t!==e.id))},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},e.id))})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>t.back(),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",children:d?"Guardando...":"Guardar Cambios"})]})]})}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Coberturas de Medios"}),(0,r.jsx)("button",{onClick:()=>{k?T():C(!0)},className:"text-sm text-indigo-600 hover:text-indigo-800",children:k?"Cancelar":"+ Agregar Cobertura"})]}),k&&(0,r.jsxs)("form",{onSubmit:A,className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-4",children:S?"Editar Cobertura":"Nueva Cobertura"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medio"}),(0,r.jsxs)("select",{required:!0,value:F.media_source_id,onChange:e=>P({...F,media_source_id:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"Seleccionar medio"}),b.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.bias_rating,")"]},e.id))]}),F.media_source_id&&(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(()=>{let e=b.find(e=>e.id.toString()===F.media_source_id),t=null==e?void 0:e.logo_url;if(!t)return null;let a=t.startsWith("http")?t:"".concat("http://localhost:3001").concat(t);return(0,r.jsx)("img",{src:a,alt:(null==e?void 0:e.name)||"",className:"h-8 w-auto object-contain",onError:e=>{e.target.style.display="none"}})})(),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:null===(e=b.find(e=>e.id.toString()===F.media_source_id))||void 0===e?void 0:e.name})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"URL de Cobertura *"}),(0,r.jsx)("input",{type:"url",required:!0,value:F.coverage_url,onChange:e=>P({...F,coverage_url:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"T\xedtulo de Cobertura *"}),(0,r.jsx)("input",{type:"text",required:!0,value:F.coverage_title,onChange:e=>P({...F,coverage_title:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Snippet (opcional)"}),(0,r.jsx)("textarea",{rows:3,value:F.snippet,onChange:e=>P({...F,snippet:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900"})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:S?"Guardar Cambios":"Agregar"}),S&&(0,r.jsx)("button",{type:"button",onClick:T,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"})]})]})]}),0===N.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No hay coberturas agregadas"}):(0,r.jsx)("div",{className:"space-y-3",children:N.map(e=>{var t,a;return(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.coverage_title}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[(null===(t=e.media_source)||void 0===t?void 0:t.name)||e.media_name," -"," ",(0,r.jsx)("span",{className:"capitalize",children:(null===(a=e.media_source)||void 0===a?void 0:a.bias_rating)||e.media_bias})]}),e.snippet&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:e.snippet}),(0,r.jsx)("a",{href:e.coverage_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-indigo-600 hover:text-indigo-800 mt-2 inline-block",children:"Ver art\xedculo â†’"})]}),(0,r.jsxs)("div",{className:"ml-4 flex space-x-3",children:[(0,r.jsx)("button",{onClick:()=>D(e),className:"text-indigo-600 hover:text-indigo-800",children:"Editar"}),(0,r.jsx)("button",{onClick:()=>R(e.id),className:"text-red-600 hover:text-red-800",children:"Eliminar"})]})]})},e.id)})})]})]})}},4417:function(e,t,a){"use strict";let r=a(1892).Z.create({baseURL:"".concat("http://localhost:3001","/api"),headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),r.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/admin/login"),Promise.reject(e)}),t.Z=r},6179:function(e,t,a){e.exports=a(319)}},function(e){e.O(0,[885,115,141,744],function(){return e(e.s=675)}),_N_E=e.O()}]);